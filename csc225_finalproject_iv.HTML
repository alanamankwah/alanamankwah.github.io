<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSC_225_FINAL_PROJECT Met Museum Gallery</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {font-family:'IBM Plex Mono',monospace;
        background:black;color:rgb(235, 235, 235);min-height:100vh
    }
        .mnav{

            background:black;border-bottom:1px solid rgb(83, 83, 83);
            
            position:fixed;top:0;left:0;right:0;z-index:1000;
            padding:20px 40px
        }
        .metname{color:white;font-size:12px;font-weight:500;
            
            letter-spacing:.3px;text-transform:uppercase;
            text-decoration:none
        }
        .category{
            color:rgb(66, 66, 66);font-size:11px;
            letter-spacing:.2px;
            text-transform:uppercase;

            margin-left:30px;
            cursor:pointer;
            text-decoration:none
        }
        .category:hover,.category.active{color:white}
        .status-text{
            font-size:11px;
            letter-spacing:.2px;
            color:rgb(132, 132, 132);
        }
        .section-title{
            font-size:1.2rem;font-weight:300;
            letter-spacing:.5px;margin-bottom:2rem
        }
        .art-card{cursor:pointer;transition:transform .2s}
        
        .art-card:hover{transform:translateY(-6px)}

        .art-image{
            width:100%;height:300px;
            object-fit:cover;
            border-radius:4px
        }
        .art-title,.artist,.loading{
            font-size:.65rem;
            letter-spacing:.5px}
        .art-title{margin-top:.75rem;color:rgb(119, 118, 118)}

        .artist{color:rgb(198, 198, 198)}
        .loading{text-align:center;padding:4rem 0;color:rgb(185, 185, 185)}
        
       
        .dp {
            display:none;
            position:fixed;
            top:0; left:0; right:0; bottom:0;

            overflow:auto;
            background:black;

            padding-top:100px;

        }
        .dp.active { display:block; }
        .gallery-page.hidden { display:none; }

        .detail-image { 
            max-width:100%; max-height:75vh; object-fit:contain;
         }

        .detail-metadata { 
            font-size:.65rem; line-height:1.6; color:white; 
        }

        .detail-label { color:rgb(125,125,125); }


        .detailpv { 
            color:rgb(255,245,245); 
        }
        .metlink { 
            display:inline-block; 
            margin-top:0.5rem; 

            color:rgb(116,176,232); 
            text-decoration:none; 
            font-size:.65rem; 
        }
        .metlink:hover { color:rgb(135,212,227); }
        .back-button { 
            background:transparent;

             border:1px solid #555; 
             color:rgb(233,233,233); 
             padding:.5rem 1rem; 
             
             font-size:.95rem; 
             cursor:pointer; 
             margin-bottom:1rem; }

        @media (max-width: 768px) {

            .detail-image { display:block; margin:0 auto 1rem auto; }
        }
    </style>
</head>
<body>
<nav class="mnav">
    <div class="d-flex justify-content-between align-items-center">

        <div class="d-flex align-items-center">
            <a href="https://www.metmuseum.org" target="_blank" class="metname">The Metropolitan Museum of Art</a>
            <a class="category active" onclick="loadArtworks('european')">European Paintings</a>
            
            <a class="category" onclick="loadArtworks('american')">American Paintings</a>
        </div>
        <div id="time"></div>
    </div>
</nav>
<div class="gallery-page container-fluid px-4" id="galleryP" style="padding-top:110px">
    <h1 class="section-title" id="currentDept">European Paintings</h1>

    <div id="gallery" class="row row-cols-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4"></div>
    <div id="loading" class="loading">Waiting for Server, artworks will load shortly...</div>
</div>


<div class="dp container-fluid" id="detailPage">
    <div class="row">
        <div class="col-12 col-md-3 d-flex flex-column">
            <button class="back-button" onclick="goBack()">Back to Gallery</button>
            <div class="detail-metadata mt-2">
                <p><span class="detail-label">ARTIST:</span> <span class="detailpv" id="detailArtist"></span></p>

                <p><span class="detail-label">MEDIUM:</span> <span class="detailpv" id="dm"></span></p>

                <p><span class="detail-label">TYPE:</span> <span class="detailpv">PAINTING</span></p>
                <p><span class="detail-label">NAME:</span> <span class="detailpv" id="detailtitil"></span></p>
                <p><span class="detail-label">DATE:</span> <span class="detailpv" id="detailDate"></span></p>

                <a id="metLink" href="" target="_blank" class="metlink">VIEW ON MET</a>
            </div>
        </div>
        <div class="col-12 col-md-9 d-flex justify-content-center align-items-center">

            <img id="detailimg" class="detail-image shadow" src="" alt="">
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
<script>
    var gallery = document.getElementById('gallery')
    var loading = document.getElementById('loading');

    var deptTitle = document.getElementById('currentDept')
    var galleryp = document.getElementById('galleryP')

    var detailPage = document.getElementById('detailPage')
    let time = document.getElementById("time");

    let currentTime = new Date();
    let hour = currentTime.getHours();
    let day = currentTime.getDay();
    
    let isOpen = false;
    let currentLoadId = 0;
    
    // Check if it is open based i got timem from google 
    if (day >= 0 && day <= 3) {
        isOpen = (hour >= 10 && hour < 17);

    } else if (day === 4) {
        isOpen = (hour >= 10 && hour < 17);
    } else if (day === 5 || day === 6) { 

        isOpen = (hour >= 10 && hour < 21);
    } else if (day === 1) { 
        isOpen = (hour >= 10 && hour < 17);
    }
    
    if (isOpen) {
        time.innerHTML = '<span class="status-text">MET is OPEN</span>'
    } 
    else {
        time.innerHTML = '<span class="status-text">opens tmr at 10am</span>';
    }
    //(gotta add) `imma add holidyyss, later 
    
    function sleep(ms) {
        return new Promise(function(resolve) {
            setTimeout(resolve, ms);
        });
    }
    function loadArtworks(category) {
        currentLoadId++

        var thisLoadId = currentLoadId;
        
        gallery.innerHTML = '';


        loading.style.display = 'block'
        loading.innerHTML = 'Loading artworks...';
        var departmentId;
        var categoryName;

        var links = document.querySelectorAll('.category');
        if (category === 'european') {
            departmentId = '11';
            categoryName = 'European Paintings'
            links[0].classList.add('active');

            links[1].classList.remove('active');
        } else {
            departmentId = '1';
            categoryName = 'American Paintings';

            links[1].classList.add('active')
            links[0].classList.remove('active');
        }
        deptTitle.textContent = categoryName;
        fetch('https://collectionapi.metmuseum.org/public/collection/v1/search?departmentId=' + departmentId + '&hasImages=true&q=painting')
            .then(function(response) { return response.json(); })
            .then(function(data) {
                if (thisLoadId !== currentLoadId) return;
                
                if (!data.objectIDs) {
                    loading.innerHTML = 'No artworks found'
                    return;
                }
                var objectIds = data.objectIDs.slice(0, 100);
                loading.style.display = 'none';
                loadArtworkDetails(objectIds, 0, thisLoadId);
            })
            .catch(function(error) {
                if (thisLoadId !== currentLoadId) return;
                loading.innerHTML = 'server busy could not load artworks';
            });
    }
    function loadArtworkDetails(objectIds, index, loadId) {
        if (loadId !== currentLoadId) return;
        
        if (index >= objectIds.length) {
            return;
        }
        var id = objectIds[index];
        fetch('https://collectionapi.metmuseum.org/public/collection/v1/objects/' + id)
            .then(function(response) { return response.json(); })
            .then(function(obj) {
                if (loadId !== currentLoadId) return;
                
                if (obj.primaryImage && obj.primaryImageSmall) {

                    var card = document.createElement('div')

                    card.className = 'col art-card';
                    var img = document.createElement('img');
                    img.src = obj.primaryImageSmall;

                    img.className = 'art-image'
                    var title = document.createElement('div')
                    title.className = 'art-title';

                    title.textContent = obj.title || 'Untitled';
                    var artist = document.createElement('div');


                    artist.className = 'artist';
                    artist.textContent = obj.artistDisplayName || 'Unknown Artist';
                    card.appendChild(img);

                    card.appendChild(title);
                    card.appendChild(artist)

                    card.onclick = function() { showDetail(id); };
                    gallery.appendChild(card);
                }
                sleep(300).then(function() {
                    loadArtworkDetails(objectIds, index + 1, loadId)
                });
            })
            .catch(function(error) {

                if (loadId !== currentLoadId) return;
                sleep(300).then(function() {
                    loadArtworkDetails(objectIds, index + 1, loadId);
                });
            });
    }
    function showDetail(objectId) {
        galleryp.classList.add('hidden');
        detailPage.classList.add('active');
        document.getElementById('detailimg').src = ''

        document.getElementById('detailtitil').textContent = 'Loading...'

        document.getElementById('detailArtist').textContent = ''

        document.getElementById('detailDate').textContent = '';

        document.getElementById('dm').textContent = '';
        document.getElementById('metLink').href = ''
        
        fetch('https://collectionapi.metmuseum.org/public/collection/v1/objects/' + objectId)
            .then(function(response) { return response.json(); })
            .then(function(obj) {
                document.getElementById('detailimg').src = obj.primaryImage || obj.primaryImageSmall;

                document.getElementById('detailtitil').textContent = obj.title || 'Untitled'
                document.getElementById('detailArtist').textContent = obj.artistDisplayName || 'Unknown Artist';


                document.getElementById('detailDate').textContent = obj.objectDate || 'Date unknown';

                document.getElementById('dm').textContent = obj.medium || 'Medium not specified';
                document.getElementById('metLink').href = obj.objectURL || 'https://www.metmuseum.org'
            })
            .catch(function(error) {
                document.getElementById('detailtitil').textContent = 'Could not load artwork';
            });
    }
    function goBack() {
        detailPage.classList.remove('active')

        galleryp.classList.remove('hidden');
    }
    loadArtworks('european');
</script>
</body>
</html>
