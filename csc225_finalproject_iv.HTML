<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSC_225_FINAL_PROJECT Met Museum Gallery</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'IBM Plex Mono', monospace;
            background: #000;
            color: #fff;
            min-height: 100vh;
        
        }
        a { color: inherit; text-decoration: none; }
        a:hover { color: #fff; }
        
        nav {
            background: #000;
            position: fixed;
            top: 0; left: 0; right: 0;
            z-index: 1000;
            padding: 20px 40px;
        }
        .metname {
            font-size: 12px;
            font-weight: 500;
            letter-spacing: .3px;
            
        }
        .category,#time {
            font-size: 11px;
            letter-spacing: .2px;
            text-transform: uppercase;
            margin-left: 30px;
            color: #666;
        }
        .category.active { color: #fff; }
        
        #galleryP { padding-top: 110px; }
        
        #loading { 
            text-align: center; 
            font-size: .65rem;
            color: #888; 
        }
        
        .artwork-card {
            transition: transform .2s;
        }
        .artwork-card:hover {
            transform: translateY(-6px);
        }
        .artwork-card img {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }
        
        .darkfonts { 
            margin-top: .75rem; 
            font-size: .65rem;
            letter-spacing: .5px;
            color: rgb(119, 118, 118);
        }
        .lf { 
            font-size: .65rem; 
            letter-spacing: .5px;
            color: rgb(236, 236, 236);
        }
        #detailPage {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            overflow: auto;
            background: #000;
            padding-top: 100px;
        }
        #detailPage.active {
            display: block;
        }
        .gallery-page.hidden {
            display: none;
        }
        #detailPage button {
            background: transparent;
            border: 1px solid #555;
            color: rgb(233, 233, 233);
            padding: .5rem 1rem;
            font-size: .95rem;
        }
        #detailPage .info { 
            font-size: .65rem;  line-height: 1.6; 
        }
        
        #detailPage img { max-width: 100%; max-height: 75vh; object-fit: contain; }
        
        #metLink { 
            color: rgb(116, 176, 232);
            font-size: .65rem;
            
        }
        #metLink:hover { color: rgb(135, 212, 227); }

    </style>
</head>
<body>
<nav>
    <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
            <a href="https://www.metmuseum.org" target="_blank" class="metname">The Metropolitan Museum of Art</a>
            <a class="category active" onclick="loadArtworks('european')">European Paintings</a>
            
            <a class="category" onclick="loadArtworks('american')">American Paintings</a>
        </div>
        <div id="time"></div>
    </div>
</nav>
    <div class="gallery-page container-fluid px-4" id="galleryP">
    <div id="gallery" class="row row-cols-2 row-cols-md-3 row-cols-lg-4 row-cols-xl-5 g-4"></div>
    <div id="loading">Waiting for Server, artworks will load shortly...</div>
</div>
<div id="detailPage">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12 col-md-3 d-flex flex-column">
                <button onclick="goBack()">Back to Gallery</button>
                <div class="mt-2 info">
                    <p><span class="darkfonts">ARTIST:</span> <span class="lf" id="detailArtist"></span></p>
                    <p><span class="darkfonts">MEDIUM:</span> <span class="lf" id="dm"></span></p>
                    <p><span class="darkfonts">TYPE:</span> <span class="lf">PAINTING</span></p>
                    <p><span class="darkfonts">NAME:</span> <span class="lf" id="detailtitil"></span></p>
                    <p><span class="darkfonts">DATE:</span> <span class="lf" id="detailDate"></span></p>
                    <a id="metLink" href="" target="_blank">VIEW ON MET</a>
                </div>
            </div>
            <div class="col-12 col-md-9 d-flex justify-content-center align-items-center">
                <img id="detailimg" src="" alt="">
            </div>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
<script>
    var gallery = document.getElementById('gallery')
    var loading = document.getElementById('loading');
    var galleryp = document.getElementById('galleryP')
    var detailPage = document.getElementById('detailPage')
    let time = document.getElementById("time");
    let currentTime = new Date();
    let hour = currentTime.getHours();
    let day = currentTime.getDay();
    
    let isOpen = false;
    let currentLoadId = 0;
    
    // Check if it is open based i got timem from google 
    if (day >= 0 && day <= 3) {
        isOpen = (hour >= 10 && hour < 17);
    } else if (day === 4) {
        isOpen = (hour >= 10 && hour < 17);
    } else if (day === 5 || day === 6) { 
        isOpen = (hour >= 10 && hour < 21);
    } else if (day === 1) { 
        isOpen = (hour >= 10 && hour < 17);
    }
    
    if (isOpen) {
        time.innerHTML = '<span class="status-text">MET is OPEN</span>'
    } 
    else {
        time.innerHTML = '<span class="status-text">opens tmr at 10am</span>';
    }
    //(gotta add) `imma add holidyyss, later 
    
    function sleep(ms) {
        return new Promise(function(resolve) {
            setTimeout(resolve, ms);
        });
    }
    function loadArtworks(category) {
        currentLoadId++
        var thisLoadId = currentLoadId;
        
        gallery.innerHTML = '';
        loading.style.display = 'block'
        loading.innerHTML = 'Loading artworks...';
        var departmentId;
        var categoryName;
        var links = document.querySelectorAll('.category');
        if (category === 'european') {
            departmentId = '11';
            categoryName = 'European Paintings'
            links[0].classList.add('active');
            links[1].classList.remove('active');
        } else {
            departmentId = '1';
            categoryName = 'American Paintings';
            links[1].classList.add('active')
            links[0].classList.remove('active');
        }
        fetch('https://collectionapi.metmuseum.org/public/collection/v1/search?departmentId=' + departmentId + '&hasImages=true&q=painting')
            .then(function(response) { return response.json(); })
            .then(function(data) {
                if (thisLoadId !== currentLoadId) return;
                
                if (!data.objectIDs) {
                    loading.innerHTML = 'No artworks found'
                    return;
                }
                var objectIds = data.objectIDs.slice(0, 100);
                loading.style.display = 'none';
                loadArtworkDetails(objectIds, 0, thisLoadId);
            })
            .catch(function(error) {
                if (thisLoadId !== currentLoadId) return;
                loading.innerHTML = 'server busy could not load artworks';
            });
    }
    function loadArtworkDetails(objectIds, index, loadId) {
        if (loadId !== currentLoadId) return;
        
        if (index >= objectIds.length) {
            return;
        }
        var id = objectIds[index];
        fetch('https://collectionapi.metmuseum.org/public/collection/v1/objects/' + id)
            .then(function(response) { return response.json(); })
            .then(function(obj) {
                if (loadId !== currentLoadId) return;
                
                if (obj.primaryImage && obj.primaryImageSmall) {
                    var card = document.createElement('div')
                    card.className = 'col artwork-card';
                    var img = document.createElement('img');
                    img.src = obj.primaryImageSmall;
                    var title = document.createElement('div')
                    title.className = 'darkfonts';
                    title.textContent = obj.title || 'Untitled';
                    var artist = document.createElement('div');
                    artist.className = 'lf';
                    artist.textContent = obj.artistDisplayName || 'Unknown Artist';
                    card.appendChild(img);
                    card.appendChild(title);
                    card.appendChild(artist)
                    card.onclick = function() { showDetail(id); };
                    gallery.appendChild(card);
                }
                sleep(300).then(function() {
                    loadArtworkDetails(objectIds, index + 1, loadId)
                });
            })
            .catch(function(error) {
                if (loadId !== currentLoadId) return;
                sleep(300).then(function() {
                    loadArtworkDetails(objectIds, index + 1, loadId);
                });
            });
    }
    function showDetail(objectId) {
        galleryp.classList.add('hidden');
        detailPage.classList.add('active');
        document.getElementById('detailimg').src = ''
        document.getElementById('detailtitil').textContent = 'Loading...'
        document.getElementById('detailArtist').textContent = ''
        document.getElementById('detailDate').textContent = '';
        document.getElementById('dm').textContent = '';
        document.getElementById('metLink').href = ''
        
        fetch('https://collectionapi.metmuseum.org/public/collection/v1/objects/' + objectId)
            .then(function(response) { return response.json(); })
            .then(function(obj) {
                document.getElementById('detailimg').src = obj.primaryImage || obj.primaryImageSmall;
                document.getElementById('detailtitil').textContent = obj.title || 'Untitled'
                document.getElementById('detailArtist').textContent = obj.artistDisplayName || 'Unknown Artist';
                document.getElementById('detailDate').textContent = obj.objectDate || 'Date unknown';
                document.getElementById('dm').textContent = obj.medium || 'Medium not specified';
                document.getElementById('metLink').href = obj.objectURL || 'https://www.metmuseum.org'
            })
            .catch(function(error) {
                document.getElementById('detailtitil').textContent = 'Could not load artwork';
            });
    }
    function goBack() {
        detailPage.classList.remove('active')
        galleryp.classList.remove('hidden');
    }
    loadArtworks('european');
</script>
</body>
</html>