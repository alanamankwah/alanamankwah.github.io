<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>There's no tomorrow like today</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #1a1a1a; color: #fff; font-family: 'IBM Plex Mono', monospace;
            min-height: 100vh; display: flex; flex-direction: column; cursor: none;
        }
        .custom-cursor {
            position: fixed; width: 20px; height: 20px; border-radius: 100%;
            background: #f53105; pointer-events: none; z-index: 1000;
            transition: width .3s, height .3s, border-radius .3s, box-shadow .3s,
                        left .08s cubic-bezier(0.25,0.46,0.45,0.94),
                        top .08s cubic-bezier(0.25,0.46,0.45,0.94);
        }
        .header { padding: 40px 60px; display: flex; justify-content: space-between; align-items: center; }
        .title { display: flex; align-items: center; gap: 10px; font-size: 15px; color: #aaa; }
        .file-size { font-size: 12px; color: #666; text-decoration: underline; }
        .chart-container { flex: 1; display: flex; align-items: center; overflow: hidden; }
        .bars-scroll {
            width: 100%; height: 100%; overflow-x: auto; overflow-y: hidden;
            scroll-behavior: smooth; -webkit-overflow-scrolling: touch;
        }
        .bars-scroll::-webkit-scrollbar { display: none; }
        .bars { display: flex; gap: 5px; align-items: flex-end; padding: 60px 20px; height: 100%; min-width: max-content; }
        .bar { width: 1px; background: #f5f5f5; transition: background 0.2s; }
        .bar.highlight { background: #ff4500; }
        .bar.yellow { background: #ffeb3b;  }
        .bar.inactive { background: #444; height: 18px !important; }
        .bar-info { position: fixed; pointer-events: none; z-index: 5; opacity: 0; text-align: center; white-space: nowrap; font-family: 'IBM Plex Mono', monospace; }
        .bar-info.visible { opacity: 1; }
        .bar-info-top, .bar-info-bottom {
            position: fixed; left: 50%; transform: translateX(-50%);
            font-size: 12px; letter-spacing: 1px; font-family: 'IBM Plex Mono', monospace;
        }
        .bar-info-top { top: 80px; color: #e0e0e0; }
        .bar-info-bottom { bottom: 80px; color: #666; }
    </style>
</head>
<body>
    <div class="custom-cursor" id="cursor"></div>
    <div class="bar-info" id="barInfo">
        <div class="bar-info-top" id="barInfoTop">22.55km ‚Ä¢ 4:27/km</div>
        <div class="bar-info-bottom" id="barInfoBottom">Feb 18th</div>
    </div>
    
    <div class="header">
        <div class="title"><span>üèÉ</span><span>There's no tomorrow like today</span></div>
        <div class="file-size">8334ka</div>
    </div>
    
    <div class="chart-container">
        <div class="bars-scroll" id="barsScroll">
            <div class="bars" id="bars"></div>
        </div>
    </div>
    <script>
        /* -------------------------------------------------------------
         FIXED SOUND SYSTEM
        --------------------------------------------------------------*/
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        document.addEventListener("Hover", () => audioContext.resume(), { once: true });

        function playClickSound() {
            const now = audioContext.currentTime;
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.type = "square";
            osc.frequency.setValueAtTime(1100, now);
            osc.frequency.exponentialRampToValueAtTime(9000, now + 0.0);
            gain.gain.setValueAtTime(0.25, now);
            gain.gain.exponentialRampToValueAtTime(0.0001, now + 0.0001);
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.start(now);
            osc.stop(now + 0.002);
        }

        function playBubbleSound() {
            const now = audioContext.currentTime;
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            osc.connect(gain);
            gain.connect(audioContext.destination);
            osc.frequency.setValueAtTime(400, now);
            osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);
            gain.gain.setValueAtTime(0.01, now);
            gain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);
            osc.start(now);
            osc.stop(now + 0.08);
        }

        /* Scroll-based tick */
        let lastScrollX = 0;
        const barsScroll = document.getElementById('barsScroll');
        barsScroll.addEventListener("scroll", () => {
            const x = barsScroll.scrollLeft;
            if (Math.abs(x - lastScrollX) > 0.2) {
                playClickSound();
                lastScrollX = x;
            }
        });

        /* ------------------------------------------------------------- */
        const cursor = document.getElementById('cursor');
        const barInfo = document.getElementById('barInfo');
        let mouseX = 0, mouseY = 0;
        let lastBarIndex = -1;
        let isOverChart = false;
        let wasOverChart = false;

        document.addEventListener('mousemove', (e) => {
            mouseX = e.clientX;
            mouseY = e.clientY;
            const chartRect = barsScroll.getBoundingClientRect();
            isOverChart =
                mouseX >= chartRect.left &&
                mouseX <= chartRect.right &&
                mouseY >= chartRect.top &&
                mouseY <= chartRect.bottom;

            const SNAP_THRESHOLD = 3; // half of bar+gap width

            if (isOverChart && !wasOverChart) {
                playBubbleSound();
                const centerY = chartRect.top + chartRect.height / 2;
                cursor.style.left = mouseX + 'px';
                cursor.style.top = centerY + 'px';
                cursor.style.width = '2px';
                cursor.style.height = '420px';
                cursor.style.borderRadius = '1px';
                cursor.style.transform = 'translate(-50%, -50%)';
                barInfo.classList.add('visible');
            } else if (!isOverChart && wasOverChart) {
                playBubbleSound();
                cursor.style.left = mouseX + 'px';
                cursor.style.top = mouseY + 'px';
                cursor.style.width = '20px';
                cursor.style.height = '20px';
                cursor.style.borderRadius = '50%';
                barInfo.classList.remove('visible');
                lastBarIndex = -1;
            } else if (isOverChart) {
                const centerY = chartRect.top + chartRect.height / 2;
                const bars = document.querySelectorAll('.bar');
                let hoveredBar = null;
                let barIndex = -1;
                let barCenterX = mouseX;
                let minDistance = Infinity;

                bars.forEach((bar, idx) => {
                    const rect = bar.getBoundingClientRect();
                    const barCenter = (rect.left + rect.right) / 2;
                    const distance = Math.abs(mouseX - barCenter);

                    if (distance < minDistance) {
                        minDistance = distance;
                        hoveredBar = bar;
                        barIndex = idx;
                        barCenterX = barCenter;
                    }
                });

                cursor.style.left = barCenterX + 'px';
                cursor.style.top = centerY + 'px';

                // Only update display when bar changes AND cursor is close enough
                if (barIndex !== lastBarIndex && hoveredBar && minDistance <= SNAP_THRESHOLD) {
                    const month = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'][Math.floor(barIndex / 30)];
                    const day = (barIndex % 30) + 1;
                    document.getElementById('barInfoBottom').textContent = `${month} ${day}th`;

                    if (hoveredBar.classList.contains('inactive')) {
                        document.getElementById('barInfoTop').textContent = `REST ‚Ä¢ ‚Äî`;
                    } else {
                        const distance = (Math.random() * 25 + 5).toFixed(2);
                        const pace = Math.floor(Math.random() * 2) + 4;
                        const sec = Math.floor(Math.random() * 60);
                        document.getElementById('barInfoTop').textContent = `${distance}km ‚Ä¢ ${pace}:${String(sec).padStart(2, '0')}/km`;
                    }

                    playClickSound();       // tick sound plays here
                    lastBarIndex = barIndex;
                }
                barInfo.classList.add('visible');
            } else {
                cursor.style.left = mouseX + 'px';
                cursor.style.top = mouseY + 'px';
            }

            wasOverChart = isOverChart;
        });

        /* ------------------------------------------------------------- */
        const barsContainer = document.getElementById('bars');
        const orangeIndices = [45, 95, 180, 240, 310, 420, 520, 650];
        const yellowIndices = [120, 280, 450, 600, 700];

        for (let i = 0; i < 730; i++) {
            const bar = document.createElement('div');
            bar.className = 'bar';

            if (yellowIndices.includes(i)) {
                bar.classList.add('yellow');
                bar.style.height = (Math.random() * 160 + 80) + 'px';
            } else if (orangeIndices.includes(i)) {
                bar.classList.add('highlight');
                bar.style.height = (Math.random() * 160 + 80) + 'px';
            } else {
                if (Math.random() > 0.4) {
                    bar.classList.add('inactive');
                } else {
                    bar.style.height = (Math.random() * 200 + 60) + 'px';
                }
            }
            barsContainer.appendChild(bar);
        }
        setTimeout(() => { barsScroll.scrollLeft = 200; }, 100);
    </script>
</body>
</html>
